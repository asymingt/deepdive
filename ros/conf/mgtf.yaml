# CALIBRATION PARAMETERS
#
# The calibration node is responsible for estimating and maintaining the
# fixed transforms from the world to lighthouse, and from the set of
# rigidly connected trackers to what we consider to be the body frame. It
# does so by framing the localization problem as least-square error
# minimization over a connected graph
#
# Our approach uses only light measurements and pose corrections to solve
# for the lighthouse positions in the world frame and the transforms of
# the trackers (mechanical frame) with respect to the body frame..
#
# If the calibration procedure works as expected, we'll have a set of
# lighthouse -> world and tracker -> tracker/body transforms. We'll then
# write these to a calibration file, which is written to the default ROS
# working directory (~/.ros) and persisted across restarts.

# GENERAL OPTIONS

# Parent frame is the "world" frame, and child frame is typically "truth",
# and estimate is usally "body"
frames:
  parent:           "world"
  child:            "truth"
  estimate:         "body"

# Thresholds used to reject measurements
thresholds:
  count:            1          # Min pulses/sweep to add to solver
  angle:            60.0       # Threshold on angle (in degres)
  duration:         1.00       # Threshod on duration (in microsecs)
  correction:       0.01       # 10ms threshold on mapped time

# Publish rviz markers for the sensors
visualize:          true

# Apply light corrections broadcast over OOTX
correct:            true

# List of lighthouses to be included in tracking
lighthouses:
  - "lighthouse_back"
  - "lighthouse_near"
lighthouse_back:
  serial:          "2935772913"
  transform:       [-0.042, -0.971, -1.812, -0.3978,  0.0112,  0.0022,  0.9174]
lighthouse_near:
  serial:          "668207140"
  transform:       [ 0.624,  1.151, -1.691,  0.1392, -0.3011,  0.3968,  0.8559]

# List of trackers to be included in tracking (see blocks below)
trackers:
  - "tracker_port"
  - "tracker_stbd"
tracker_port:
  serial:          "LHR-09BB6B22"
  transform:       [0.000, 0.000, 0.000,  0.0000,  0.0000,  0.0000,  1.000]
tracker_stbd:
  serial:          "LHR-09DF88FD"
  transform:       [0.000, 0.000, 0.000,  0.0000,  0.0000,  0.0000,  1.000]

# CALIBRATION OPTIONS

# Maximum resolution (time difference) between poses in the graph
resolution:         0.001

# Lock the Z coordinate of the body-frame (force solution on Z plane)
force2d:            true

# What else to refine, besides the lighthouse ans sensor positions
refine:
  lighthouses:      true       # Refine lighthouse positions
  trajectory:       false      # If false we will use the corrections
  extrinsics:       false      # If false tracker frame is the body frame
  sensors:          false      # Refine sensor positions
  params:           false      # Refine lighthouse parameters
  head:             false      # Refine head transform

# Relative weighting of measurements (light/correction only used for)
weight:
  light:            1.0
  correction:       1.0
  motion:           1.0

# These are the parameters used by the non-linear least squares optimizer
solver:
  max_time:         30.0       # In seconds
  max_iterations:   100        # Number of iterations
  threads:          4          # Number of threads
  debug:            true       # Provide debug output?

# TRACKER PARAMETERS

# Topics for publishing data
topics:
  pose:             "/loc/truth/pose"     # Topic for publishing pose
  twist:            "/loc/truth/twist"    # Topic for publishing twist

# For the tracking filter

# Fixed tracking rate
rate:               62.5

# Gravity vector in parent frame
gravity:            [0.0, 0.0, 9.80665]

# Which measurements to use
use:
  gyroscope:        true
  accelerometer:    true
  light:            true

# Initial state value
initial_estimate:
  position:         [0, 0, 0]
  attitude:         [0, 0, 0, 1]
  velocity:         [0, 0, 0]
  omega:            [0, 0, 0]
  acceleration:     [0, 0, 0]
  alpha:            [0, 0, 0]

#  Initial uncertainty
initial_cov:
  position:         [4, 4, 4]
  attitude:         [10, 10, 10]
  velocity:         [1.0e-20, 1.0e-20, 1.0e-20]
  omega:            [1.0e-20, 1.0e-20, 1.0e-20]
  acceleration:     [1.0e-20, 1.0e-20, 1.0e-20]
  alpha:            [1.0e-20, 1.0e-20, 1.0e-20]

# Process noise
process_noise_cov:
  position:         [1.0e-20, 1.0e-20, 1.0e-20]
  attitude:         [1.0e-20, 1.0e-20, 1.0e-20]
  velocity:         [1.0e-20, 1.0e-20, 1.0e-20]
  omega:            [1.0e-20, 1.0e-20, 1.0e-20]
  acceleration:     [1.0e-20, 1.0e-20, 1.0e-20]
  alpha:            [1.0e-20, 1.0e-20, 1.0e-20]

#  Initial uncertainty
imu_initial_cov:
  acc_scale:        [1.0e-20, 1.0e-20, 1.0e-20]
  acc_bias:         [1.0e-20, 1.0e-20, 1.0e-20]
  gyr_scale:        [1.0e-20, 1.0e-20, 1.0e-20]
  gyr_bias:         [1.0e-04, 1.0e-04, 1.0e-04]

# Process noise
imu_process_noise_cov:
  acc_scale:        [0, 0, 0]
  acc_bias:         [0, 0, 0]
  gyr_scale:        [0, 0, 0]
  gyr_bias:         [2.4e-10, 2.4e-10, 2.4e-10]

# For measurements

measurement_cov:
  accelerometer:    [1.0e-4, 1.0e-4, 1.0e-4]
  gyroscope:        [1.0e-6, 1.0e-6, 1.0e-6]
  angle:            1.0e-8

# END OF CONFIGURATION